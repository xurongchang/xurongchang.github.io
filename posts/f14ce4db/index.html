<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ElasticSearch笔记 | Lan's Blog</title><meta name="keywords" content="全文搜索引擎,ElasticSearch,Lucene,RESTful web接口"><meta name="author" content="云雀"><meta name="copyright" content="云雀"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="一、ElasticSearch介绍1.1 引言 1、在海量数据中执行搜素功能时，如果使用MySql，效率太低。 2、关键字输入的不准确，一样可以搜索到想要的数据 3、将搜索关键字，以红色的字体展示  1.2 ES的介绍 ES 是一个使用Java语言并且基于Lucene编写的搜索引擎框架，它提供了分布式的全文搜索功能，提供了一个统一的基于RESTful风格的WEB接口，官方客户端也对多种语言都提供">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch笔记">
<meta property="og:url" content="https://xurongchang.github.io/posts/f14ce4db/index.html">
<meta property="og:site_name" content="Lan&#39;s Blog">
<meta property="og:description" content="一、ElasticSearch介绍1.1 引言 1、在海量数据中执行搜素功能时，如果使用MySql，效率太低。 2、关键字输入的不准确，一样可以搜索到想要的数据 3、将搜索关键字，以红色的字体展示  1.2 ES的介绍 ES 是一个使用Java语言并且基于Lucene编写的搜索引擎框架，它提供了分布式的全文搜索功能，提供了一个统一的基于RESTful风格的WEB接口，官方客户端也对多种语言都提供">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/quehua/blogimg/raw/master/img/20201211173025.jpg">
<meta property="article:published_time" content="2020-12-11T09:43:59.000Z">
<meta property="article:modified_time" content="2020-12-11T09:49:37.730Z">
<meta property="article:author" content="云雀">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/quehua/blogimg/raw/master/img/20201211173025.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://xurongchang.github.io/posts/f14ce4db/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7b6cd57f7be69582f3fe309d427bbbe2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 云雀","link":"链接: ","source":"来源: Lan's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-11 17:49:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Lan's Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/91.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gitee.com/quehua/blogimg/raw/master/img/20201211173025.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Lan's Blog</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">ElasticSearch笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-11T09:43:59.000Z" title="发表于 2020-12-11 17:43:59">2020-12-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-11T09:49:37.730Z" title="更新于 2020-12-11 17:49:37">2020-12-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>53分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173335.png" alt="elastic-logo"></p>
<h1 id="一、ElasticSearch介绍"><a href="#一、ElasticSearch介绍" class="headerlink" title="一、ElasticSearch介绍"></a>一、ElasticSearch介绍</h1><h3 id="1-1-引言"><a href="#1-1-引言" class="headerlink" title="1.1 引言"></a>1.1 引言</h3><blockquote>
<p>1、在海量数据中执行搜素功能时，如果使用MySql，效率太低。</p>
<p>2、关键字输入的不准确，一样可以搜索到想要的数据</p>
<p>3、将搜索关键字，以红色的字体展示</p>
</blockquote>
<h3 id="1-2-ES的介绍"><a href="#1-2-ES的介绍" class="headerlink" title="1.2 ES的介绍"></a>1.2 ES的介绍</h3><blockquote>
<p>ES 是一个使用Java语言并且基于Lucene编写的搜索引擎框架，它提供了分布式的全文搜索功能，提供了一个统一的基于RESTful风格的WEB接口，官方客户端也对多种语言都提供了相应的API。</p>
<p>Lucene : Lucene 本身就是一个搜索引擎的 底层。</p>
<p>分布式 ： ES主要为了突出它的横向扩展能力。</p>
<p>全文检索： 将一段词语进行分词，并且将分出来的单个词语统一放到 一个分词库中，在搜索时，根据关键字去分词库中检索，找到匹配的内容。(倒排索引)</p>
<p>RESTful风格的WEB接口：只需要发送一个http请求，并且根据请求方式不同，携带的参数不同，执行相应的功能。</p>
</blockquote>
<h3 id="1-3-ES的由来"><a href="#1-3-ES的由来" class="headerlink" title="1.3 ES的由来"></a>1.3 ES的由来</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173419.png" alt="image-20200724172118585"></p>
<h3 id="1-4-ES和Solr的区别"><a href="#1-4-ES和Solr的区别" class="headerlink" title="1.4 ES和Solr的区别"></a>1.4 ES和Solr的区别</h3><blockquote>
<p>1、Solr在查询死数据时，速度相对于ES会更快。但是数据时实时变化的，查询效率会下降很多，ES的查      询效率变化并不大</p>
<p>2、Solr搭建集群需要依赖ZooKeeper来帮助管理，ES本身支持集群搭建，不需要第三方。</p>
<p>3、ES对云计算和大数据支持非常好。</p>
<p>4、ES的文档很健全</p>
</blockquote>
<h3 id="1-5-倒排索引"><a href="#1-5-倒排索引" class="headerlink" title="1.5 倒排索引"></a>1.5 倒排索引</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173500.png" alt="image-20200807125012845"></p>
<blockquote>
<p>将存放的数据，以一定方式进行分词，并将分词的内容存放到一个单独的分词库中</p>
<p>当用户去查询数据时，会将用户查询的关键词进行分词</p>
<p>然后去分词库中匹配内容，最终得到数据的id标识</p>
<p>根据id标识去存放数据的位置拉取指定的内容</p>
</blockquote>
<h1 id="二、ElaticSearch安装"><a href="#二、ElaticSearch安装" class="headerlink" title="二、ElaticSearch安装"></a>二、ElaticSearch安装</h1><h3 id="2-1-、安装ES-amp-Kibana"><a href="#2-1-、安装ES-amp-Kibana" class="headerlink" title="2.1 、安装ES &amp; Kibana"></a>2.1 、安装ES &amp; Kibana</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">version:&quot;3.1&quot;</span><br><span class="line">services:</span><br><span class="line">	elasticsearch:</span><br><span class="line">		image: daocloud.io/library/elasticsearch:6.5.4</span><br><span class="line">		restart: always</span><br><span class="line">		container_name: elasticsearch</span><br><span class="line">		ports:</span><br><span class="line">			- 9200: 9200</span><br><span class="line">	kibana:</span><br><span class="line">		image: daocloud.io/library/kibana:6.5.4</span><br><span class="line">		restart: always</span><br><span class="line">		container_name: kibana</span><br><span class="line">		ports:</span><br><span class="line">			-5601: 5601</span><br><span class="line">		environment:</span><br><span class="line">			- elasticsearch_url=http://47.115.11.82:9200</span><br><span class="line">		depends_on:</span><br><span class="line">			- elasticsearch</span><br></pre></td></tr></table></figure>



<h3 id="2-2-、安装-IK-分词器"><a href="#2-2-、安装-IK-分词器" class="headerlink" title="2.2 、安装 IK 分词器"></a>2.2 、安装 IK 分词器</h3><blockquote>
<p>下载 IK 分词器的地址：</p>
<p>进入到ES容器内部，跳转到bin目录下，执行bin目录下的脚本文件：</p>
<p>./elasticsearch-plugin install </p>
<p>IK提供了两个分词算法：ik_smart和ik_word，其中ik_smart为最少切分，ik_word为最细粒度划分。</p>
</blockquote>
<h1 id="三、ElasticSearch基本操作"><a href="#三、ElasticSearch基本操作" class="headerlink" title="三、ElasticSearch基本操作"></a>三、ElasticSearch基本操作</h1><h3 id="3-1、ES的结构"><a href="#3-1、ES的结构" class="headerlink" title="3.1、ES的结构"></a>3.1、ES的结构</h3><h5 id="3-1-1-、索引Index、分片和备份。"><a href="#3-1-1-、索引Index、分片和备份。" class="headerlink" title="3.1.1 、索引Index、分片和备份。"></a>3.1.1 、索引Index、分片和备份。</h5><blockquote>
<p>ES 的服务中，可以创建多个索引。类似Mysql的多个数据库</p>
<p>每一个索引默认被分成5片存储。</p>
<p>每一个分片都会存在至少一个备份分片。</p>
<p>备份分片默认不会帮助检索数据，当ES检索压力特别大的时候，备份分片才会帮助检索数据。</p>
<p>备份分片必须放在不同的服务器中。</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173546.png" alt="image-20200807151543708"></p>
<h5 id="3-1-2-、类型Type"><a href="#3-1-2-、类型Type" class="headerlink" title="3.1.2 、类型Type"></a>3.1.2 、类型Type</h5><blockquote>
<p>一个索引下，可以创建多个类型。类似Mysql中不同的表</p>
<p>Ps:根据版本的不同，类型可创建的数量也不同</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173702.png" alt="image-20200807151731292"></p>
<h5 id="3-1-3-、文档Doc"><a href="#3-1-3-、文档Doc" class="headerlink" title="3.1.3 、文档Doc"></a>3.1.3 、文档Doc</h5><blockquote>
<p>一个类型下有多个文档。这个文档类似于Mysql中的多行数据。</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173754.png" alt="image-20200807152002952"></p>
<h3 id="3-2-、操作ES的Restful语法"><a href="#3-2-、操作ES的Restful语法" class="headerlink" title="3.2 、操作ES的Restful语法"></a>3.2 、操作ES的Restful语法</h3><blockquote>
<p>GET请求:</p>
<pre><code>http://ip:port/index:查询索引信息

http://ip:port/index/type/doc_id:查询指定的文档信息</code></pre>
<p>POST请求:</p>
<pre><code>http://ip:port/index/type/_search:查询文档，可以在请求体中添加json字符串来代表查询条件

http://ip:port/index/type/doc_id/_update:修改文档，在请求体中指定ison字符串代表修改的具体信息_</code></pre>
<p>PUT请求:</p>
<pre><code>http://ip;port/index:创建一个索引，需要在请求体中指定索引的信息，类型，结构

http://ip:port/index/type/_mappings:代表创建索引时，指定索引文档存储的属性的信息</code></pre>
<p>DELETE请求:</p>
<pre><code>http://ip:port/index:删除跑路

http://ip:port/index/type/doc_id:删除指定的文档</code></pre>
</blockquote>
<h5 id="3-1-4-、属性Filed"><a href="#3-1-4-、属性Filed" class="headerlink" title="3.1.4 、属性Filed"></a>3.1.4 、属性Filed</h5><blockquote>
<p>一个文档中，可以包含多个属性。类似于Mysql中一行数据存在多个列。</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173858.png" alt="image-20200807152414336"></p>
<h3 id="3-3、-索引的操作"><a href="#3-3、-索引的操作" class="headerlink" title="3.3、 索引的操作"></a>3.3、 索引的操作</h3><h5 id="3-3-1-、创建一个索引"><a href="#3-3-1-、创建一个索引" class="headerlink" title="3.3.1 、创建一个索引"></a>3.3.1 、创建一个索引</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个索引</span><br><span class="line">PUT /person</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span>:<span class="number">5</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span>:<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-3-2-、查看索引信息"><a href="#3-3-2-、查看索引信息" class="headerlink" title="3.3.2 、查看索引信息"></a>3.3.2 、查看索引信息</h5><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173946.png" alt="image-20200807163753875"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看索引信息</span><br><span class="line">GET /person</span><br></pre></td></tr></table></figure>

<h5 id="3-3-3-、删除索引"><a href="#3-3-3-、删除索引" class="headerlink" title="3.3.3 、删除索引"></a>3.3.3 、删除索引</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 删除索引</span><br><span class="line">DELETE /person</span><br></pre></td></tr></table></figure>



<h3 id="3-4、ES中-Filed-可以指定的类型"><a href="#3-4、ES中-Filed-可以指定的类型" class="headerlink" title="3.4、ES中 Filed 可以指定的类型"></a>3.4、ES中 Filed 可以指定的类型</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 字符串类型</span><br><span class="line">* text			- 一般用于全文检索，将当前的filed进行分词</span><br><span class="line">* keyword		- 当前的filed不会被分词</span><br><span class="line"></span><br><span class="line"># 数值类型</span><br><span class="line">* long</span><br><span class="line">* integer</span><br><span class="line">* short</span><br><span class="line">* byte</span><br><span class="line">* double</span><br><span class="line">* float</span><br><span class="line">* half_float	- 精度比float小一半</span><br><span class="line">* scaled_float  - 根据一个long和一个scaled来表达一个浮点型，long-345,scaled-100  ----&gt;3.45</span><br><span class="line"></span><br><span class="line"># 时间类型</span><br><span class="line">* date类型，针对时间类型指定具体的格式</span><br><span class="line"></span><br><span class="line"># 布尔类型</span><br><span class="line">* Boolean类型，表达true和false</span><br><span class="line"></span><br><span class="line"># 二进制类型</span><br><span class="line">* binary类型暂时支持base64 encod string</span><br><span class="line"></span><br><span class="line"># 范围类型</span><br><span class="line">* long_range    - 赋值时，无需指定具体的内容，只需要存储一个范围即可，指定gt,lt,gte,lte</span><br><span class="line">* integer_range - 同上</span><br><span class="line">* double_range	- 同上</span><br><span class="line">* float_range	- 同上</span><br><span class="line">* date_range	- 同上</span><br><span class="line">* ip_range		- 同上</span><br><span class="line"></span><br><span class="line"># 经纬度类型</span><br><span class="line">* geo_point     - 用来存储经纬度</span><br><span class="line"></span><br><span class="line"># ip类型</span><br><span class="line">* ip        	- 可以存储ipv4或者ipv6</span><br></pre></td></tr></table></figure>



<h3 id="3-5、创建索引并指定数据结构"><a href="#3-5、创建索引并指定数据结构" class="headerlink" title="3.5、创建索引并指定数据结构"></a>3.5、创建索引并指定数据结构</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># 创建索引，并指定数据结构</span><br><span class="line">PUT /book</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">     # 分片数</span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: <span class="number">5</span>,</span><br><span class="line">     # 备份数</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">   # 指定数据结构</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    # 类型  	Type</span><br><span class="line">    <span class="string">&quot;nover&quot;</span>:&#123;</span><br><span class="line">      # 文档存储的Filed 有哪些</span><br><span class="line">      <span class="string">&quot;properties&quot;</span>:&#123;</span><br><span class="line">      	# Filed的属性名</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:&#123;</span><br><span class="line">          # 属性的类型</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">          # 指定分词器</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span>:<span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">          # 指定当前的Filed可以被作为查询的条件</span><br><span class="line">          <span class="string">&quot;index&quot;</span>:<span class="string">&quot;true&quot;</span>,</span><br><span class="line">          # 是否需要额外存储，默认false</span><br><span class="line">          <span class="string">&quot;store&quot;</span>:<span class="string">&quot;false&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;count&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;onSale&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;date&quot;</span>,</span><br><span class="line">           # 时间类型的格式化方式</span><br><span class="line">          <span class="string">&quot;format&quot;</span>:<span class="string">&quot;yyyy-MM-dd HH:mm:ss || yyyy-MM-dd || epoch_millis&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;descr&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span>:<span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-6、文档的操作"><a href="#3-6、文档的操作" class="headerlink" title="3.6、文档的操作"></a>3.6、文档的操作</h3><blockquote>
<p>文档在ES服务中的唯一标识，<code>_index</code>，<code>_type</code>，<code>_id</code> 三个内容为组合，锁定一个文档，来添加还是修改。</p>
</blockquote>
<h5 id="3-6-1、新建文档"><a href="#3-6-1、新建文档" class="headerlink" title="3.6.1、新建文档"></a>3.6.1、新建文档</h5><p><code>自动生成_id</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 添加文档，自动生成id</span><br><span class="line">POST /book/nover</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;盘龙&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>:<span class="string">&quot;我吃西红柿&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;count&quot;</span>:<span class="string">&quot;100000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;onSale&quot;</span>:<span class="string">&quot;2009-01-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;descr&quot;</span>:<span class="string">&quot;大小的血睛鬃毛狮，力大无穷的紫睛金毛猿，毁天灭地的九头蛇皇，携带着毁灭雷电的恐怖雷龙……&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 返回的结果</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;book&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;nover&quot;</span>,</span><br><span class="line">  &quot;_id&quot; : &quot;Gq3H5nMBvQ2hcQ99m2Bc&quot;,    -----&gt; # 自动指定的id</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;result&quot; : &quot;created&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 0,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>手动指定_id</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 添加文档，手动生成id</span><br><span class="line">POST /book/nover/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;遮天&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>:<span class="string">&quot;辰东&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;count&quot;</span>:<span class="string">&quot;100000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;onSale&quot;</span>:<span class="string">&quot;2008-01-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;descr&quot;</span>:<span class="string">&quot;冰冷与黑暗并存的宇宙深处，九具庞大的龙尸拉着一口青铜古棺，亘古长存。这是太空探测器在枯寂的宇宙中捕捉到的一幅极其震撼的画面。九龙拉棺，究竟是...&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 返回的结果</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;book&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;nover&quot;</span>,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,    -----&gt; # 手动指定的id</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;result&quot; : &quot;created&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 0,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-6-2、修改文档"><a href="#3-6-2、修改文档" class="headerlink" title="3.6.2、修改文档"></a>3.6.2、修改文档</h5><p><code>覆盖式修改</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 添加文档，自动生成id</span><br><span class="line">POST /book/nover/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;盘龙&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>:<span class="string">&quot;我吃西红柿&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;count&quot;</span>:<span class="string">&quot;100000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;onSale&quot;</span>:<span class="string">&quot;2009-01-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;descr&quot;</span>:<span class="string">&quot;大小的血睛鬃毛狮，力大无穷的紫睛金毛猿，毁天灭地的九头蛇皇，携带着毁灭雷电的恐怖雷龙……&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>doc修改</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 修改文档，基于doc方式</span><br><span class="line">POST /book/nover/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;doc&quot;</span>: &#123;</span><br><span class="line">     # 指定需要修改的filed和对应的值</span><br><span class="line">    &quot;count&quot;:&quot;123456&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-6-3、删除文档"><a href="#3-6-3、删除文档" class="headerlink" title="3.6.3、删除文档"></a>3.6.3、删除文档</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 根据id删除文档</span><br><span class="line">DELETE /book/nover/文档的id</span><br></pre></td></tr></table></figure>



<h1 id="四、Java操作ElasticSearch"><a href="#四、Java操作ElasticSearch" class="headerlink" title="四、Java操作ElasticSearch"></a>四、Java操作ElasticSearch</h1><h3 id="4-1、Java连接ES"><a href="#4-1、Java连接ES" class="headerlink" title="4.1、Java连接ES"></a>4.1、Java连接ES</h3><blockquote>
<p>1、创建Maven工程</p>
</blockquote>
<blockquote>
<p>2、导入依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1、elasticsearch --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2、elasticsearch高级API --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3、junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4、lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建测试类，连接ES</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ESClint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RestHighLevelClient <span class="title">getClient</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建HttpHost对象</span></span><br><span class="line">        HttpHost httpHost = <span class="keyword">new</span> HttpHost(<span class="string">&quot;localhost&quot;</span>,<span class="number">9200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 restClientBuilder</span></span><br><span class="line">        RestClientBuilder clientBuilder = RestClient.builder(httpHost);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 RestHighLevelClient</span></span><br><span class="line">        RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(clientBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回</span></span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4-2、Java创建索引"><a href="#4-2、Java创建索引" class="headerlink" title="4.2、Java创建索引"></a>4.2、Java创建索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2</span> </span>&#123;</span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、准备索引的 settings</span></span><br><span class="line">        Settings.Builder settings = Settings.builder()</span><br><span class="line">                .put(<span class="string">&quot;number_of_shards&quot;</span>, <span class="number">3</span>)</span><br><span class="line">                .put(<span class="string">&quot;number_of_replicas&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、准备关于索引结构的 mappings</span></span><br><span class="line">        XContentBuilder mappings = JsonXContent.contentBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                    .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                        .startObject(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                            .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;text&quot;</span>)</span><br><span class="line">                        .endObject()</span><br><span class="line">                        .startObject(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                            .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                        .endObject()</span><br><span class="line">                        .startObject(<span class="string">&quot;birthday&quot;</span>)</span><br><span class="line">                            .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;date&quot;</span>)</span><br><span class="line">                            .field(<span class="string">&quot;format&quot;</span>,<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                        .endObject()</span><br><span class="line">                    .endObject()</span><br><span class="line">                .endObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、将settings 和 mappings 封装到request对象中</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(index)</span><br><span class="line">                .settings(settings)</span><br><span class="line">                .mapping(type,mappings);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、通过 client 对象去连接 ES 创建索引</span></span><br><span class="line">        CreateIndexResponse response = client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;resp:&quot;</span>+response.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-3、检查索引是否存在、删除索引"><a href="#4-3、检查索引是否存在、删除索引" class="headerlink" title="4.3、检查索引是否存在、删除索引"></a>4.3、检查索引是否存在、删除索引</h3><p><code>检查索引是否存在</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2</span> </span>&#123;</span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exists</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、准备request对象</span></span><br><span class="line">        GetIndexRequest request = <span class="keyword">new</span> GetIndexRequest();</span><br><span class="line">        request.indices(index);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、通过client去操作</span></span><br><span class="line">        <span class="keyword">boolean</span> exists = client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、输出</span></span><br><span class="line">        System.out.println(exists);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、准备request对象</span></span><br><span class="line">        DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest();</span><br><span class="line">        request.indices(index);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、通过client对象执行</span></span><br><span class="line">        AcknowledgedResponse delete = client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、输出</span></span><br><span class="line">        System.out.println(delete.isAcknowledged());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>删除索引</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2</span> </span>&#123;</span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、准备request对象</span></span><br><span class="line">        DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest();</span><br><span class="line">        request.indices(index);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、通过client对象执行</span></span><br><span class="line">        AcknowledgedResponse delete = client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、输出</span></span><br><span class="line">        System.out.println(delete.isAcknowledged());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-4-、Java操作文档"><a href="#4-4-、Java操作文档" class="headerlink" title="4.4 、Java操作文档"></a>4.4 、Java操作文档</h3><h5 id="4-4-1、添加文档操作"><a href="#4-4-1、添加文档操作" class="headerlink" title="4.4.1、添加文档操作"></a>4.4.1、添加文档操作</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();     <span class="comment">// 获得jackson的mapper对象</span></span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、准备一组json数据</span></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>,<span class="number">21</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        String json = mapper.writeValueAsString(person);  <span class="comment">// 将person 对象序列化成json</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、准备request对象</span></span><br><span class="line">        IndexRequest request = <span class="keyword">new</span> IndexRequest(index,type,person.getId().toString());</span><br><span class="line">        request.source(json, XContentType.JSON);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过client对象操作</span></span><br><span class="line">        IndexResponse index = client.index(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">        System.out.println(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="4-4-2、修改文档"><a href="#4-4-2、修改文档" class="headerlink" title="4.4.2、修改文档"></a>4.4.2、修改文档</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建一个Map，指定需要修改的内容</span></span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;鸢九&quot;</span>);</span><br><span class="line">        String doc_id = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="comment">// 2、创建request对象，封装数据</span></span><br><span class="line">        UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(index,type,doc_id);</span><br><span class="line">        updateRequest.doc(map);</span><br><span class="line">        <span class="comment">// 3、通过client对象执行</span></span><br><span class="line">        UpdateResponse update = client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="4-4-3、删除文档"><a href="#4-4-3、删除文档" class="headerlink" title="4.4.3、删除文档"></a>4.4.3、删除文档</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、直接封装request对象，根据id删除嘛</span></span><br><span class="line">        DeleteRequest request = <span class="keyword">new</span> DeleteRequest(index,type,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、通过client对象执行</span></span><br><span class="line">        DeleteResponse delete = client.delete(request,RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、输出</span></span><br><span class="line">        System.out.println(delete.getResult().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="4-4-4、Java批量操作文档"><a href="#4-4-4、Java批量操作文档" class="headerlink" title="4.4.4、Java批量操作文档"></a>4.4.4、Java批量操作文档</h5><p><strong>批量添加</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bulkCreatDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、准备多个数据</span></span><br><span class="line">        Person person1 = <span class="keyword">new</span> Person(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">23</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        Person person2 = <span class="keyword">new</span> Person(<span class="number">2</span>, <span class="string">&quot;李四&quot;</span>, <span class="number">24</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        Person person3 = <span class="keyword">new</span> Person(<span class="number">3</span>, <span class="string">&quot;王五&quot;</span>, <span class="number">25</span>, <span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        String json1 = mapper.writeValueAsString(person1);</span><br><span class="line">        String json2 = mapper.writeValueAsString(person2);</span><br><span class="line">        String json3 = mapper.writeValueAsString(person3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、创建Request，将多个数据封装进去</span></span><br><span class="line">        BulkRequest request = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">        request.add(<span class="keyword">new</span> IndexRequest(index,type,person1.getId().toString()).source(json1,XContentType.JSON));</span><br><span class="line">        request.add(<span class="keyword">new</span> IndexRequest(index,type,person2.getId().toString()).source(json2,XContentType.JSON));</span><br><span class="line">        request.add(<span class="keyword">new</span> IndexRequest(index,type,person3.getId().toString()).source(json3,XContentType.JSON));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、用client执行</span></span><br><span class="line">        BulkResponse bulk = client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">        System.out.println(bulk);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>批量删除</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    RestHighLevelClient client = ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;person&quot;</span>;</span><br><span class="line">    String type  = <span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bulkDeleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、封装request对象</span></span><br><span class="line">        BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">        bulkRequest.add(<span class="keyword">new</span> DeleteRequest(index,type,<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        bulkRequest.add(<span class="keyword">new</span> DeleteRequest(index,type,<span class="string">&quot;3&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、通过Client对象执行</span></span><br><span class="line">        BulkResponse bulk = client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、输出</span></span><br><span class="line">        System.out.println(bulk);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="五、ElasticSearch练习"><a href="#五、ElasticSearch练习" class="headerlink" title="五、ElasticSearch练习"></a>五、ElasticSearch练习</h1><ul>
<li>索引 ： sms-logs-index</li>
<li>类型：sms-logs-type</li>
</ul>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>createDate</td>
<td>创建时间String</td>
</tr>
<tr>
<td>sendDate</td>
<td>发送时间 date</td>
</tr>
<tr>
<td>longCode</td>
<td>发送长号码 如 16092389287811 string</td>
</tr>
<tr>
<td>Mobile</td>
<td>如 13000000000</td>
</tr>
<tr>
<td>corpName</td>
<td>发送公司名称，需要分词检索</td>
</tr>
<tr>
<td>smsContent</td>
<td>下发短信内容，需要分词检索</td>
</tr>
<tr>
<td>State</td>
<td>短信下发状态 0 成功 1 失败 integer</td>
</tr>
<tr>
<td>Operatorid</td>
<td>运营商编号1移动2联通3电信 integer</td>
</tr>
<tr>
<td>Province</td>
<td>省份</td>
</tr>
<tr>
<td>ipAddr</td>
<td>下发服务器IP地址</td>
</tr>
<tr>
<td>replyTotal</td>
<td>短信状态报告返回时长 integer</td>
</tr>
<tr>
<td>Fee</td>
<td>扣费 integer</td>
</tr>
</tbody></table>
<h3 id="5-1、POJO类"><a href="#5-1、POJO类" class="headerlink" title="5.1、POJO类"></a>5.1、POJO类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsLogs</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer Id;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date sendDate;</span><br><span class="line">    <span class="keyword">private</span> String longCode;</span><br><span class="line">    <span class="keyword">private</span> String Mobile;</span><br><span class="line">    <span class="keyword">private</span> String CorpName;</span><br><span class="line">    <span class="keyword">private</span> String SmsContent;</span><br><span class="line">    <span class="keyword">private</span> Integer State;</span><br><span class="line">    <span class="keyword">private</span> Integer OperatorId;</span><br><span class="line">    <span class="keyword">private</span> String Province;</span><br><span class="line">    <span class="keyword">private</span> String IpAddr;</span><br><span class="line">    <span class="keyword">private</span> Integer ReplyTotal;</span><br><span class="line">    <span class="keyword">private</span> String Fee;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String doc = <span class="string">&quot;冰冷与黑暗并存的宇宙深处，九具庞大的龙尸拉着一口青铜古棺，亘古长存。&quot;</span> +<span class="string">&quot;这是太空探测器在枯寂的宇宙中捕捉到的一幅极其震撼的画面。九龙拉棺，究竟是回到了上古，还是来&quot;</span> +<span class="string">&quot;到了星空的彼岸？一个浩大的仙侠世界，光怪陆离，神秘无尽。热血似火山沸腾，激情若瀚海汹涌，欲&quot;</span> +<span class="string">&quot;望如深渊无止境……登天路，踏歌行，弹指遮天。激情若瀚海汹涌，欲望如深渊无止境……登天路，踏歌行，&quot;</span> +<span class="string">&quot;弹指遮天激情若瀚海汹涌，欲望如深渊无止境……登天路，踏歌行，弹指遮天激情若瀚海汹涌，欲望如深;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2、创建索引和导入数据"><a href="#5-2、创建索引和导入数据" class="headerlink" title="5.2、创建索引和导入数据"></a>5.2、创建索引和导入数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo4</span> </span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">// 1.准备关于索引的setting</span></span><br><span class="line">        Settings.Builder settings = Settings.builder()</span><br><span class="line">                .put(<span class="string">&quot;number_of_shards&quot;</span>, <span class="number">3</span>)</span><br><span class="line">                .put(<span class="string">&quot;number_of_replicas&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.准备关于索引的mapping</span></span><br><span class="line">        XContentBuilder mappings = JsonXContent.contentBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                .startObject(<span class="string">&quot;corpName&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;keyword&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;createDate&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;date&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;format&quot;</span>, <span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;fee&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;long&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;ipAddr&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;ip&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;longCode&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;keyword&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;mobile&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;keyword&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;operatorId&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;province&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;keyword&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;replyTotal&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;sendDate&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;date&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;format&quot;</span>, <span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;smsContent&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;analyzer&quot;</span>, <span class="string">&quot;ik_max_word&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;state&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .endObject()</span><br><span class="line">                .endObject();</span><br><span class="line">        <span class="comment">// 3.将settings和mappings 封装到到一个Request对象中</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(index)</span><br><span class="line">                .settings(settings)</span><br><span class="line">                .mapping(type,mappings);</span><br><span class="line">        <span class="comment">// 4.使用client 去连接ES</span></span><br><span class="line">        CreateIndexResponse response = client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;response:&quot;</span>+response.toString());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">bulkCreateDoc</span><span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        <span class="comment">// 1.准备多个json 对象</span></span><br><span class="line">        String longcode = <span class="string">&quot;1008687&quot;</span>;</span><br><span class="line">        String mobile =<span class="string">&quot;138340658&quot;</span>;</span><br><span class="line">        List&lt;String&gt; companies = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        companies.add(<span class="string">&quot;腾讯课堂&quot;</span>);</span><br><span class="line">        companies.add(<span class="string">&quot;阿里旺旺&quot;</span>);</span><br><span class="line">        companies.add(<span class="string">&quot;海尔电器&quot;</span>);</span><br><span class="line">        companies.add(<span class="string">&quot;海尔智家公司&quot;</span>);</span><br><span class="line">        companies.add(<span class="string">&quot;格力汽车&quot;</span>);</span><br><span class="line">        companies.add(<span class="string">&quot;苏宁易购&quot;</span>);</span><br><span class="line">        List&lt;String&gt; provinces = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        provinces.add(<span class="string">&quot;北京&quot;</span>);</span><br><span class="line">        provinces.add(<span class="string">&quot;重庆&quot;</span>);</span><br><span class="line">        provinces.add(<span class="string">&quot;上海&quot;</span>);</span><br><span class="line">        provinces.add(<span class="string">&quot;晋城&quot;</span>);</span><br><span class="line"></span><br><span class="line">        BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;<span class="number">16</span> ; i++) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            SmsLogs s1 = <span class="keyword">new</span> SmsLogs();</span><br><span class="line">            s1.setId(i);</span><br><span class="line">            s1.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">            s1.setSendDate(<span class="keyword">new</span> Date());</span><br><span class="line">            s1.setLongCode(longcode+i);</span><br><span class="line">            s1.setMobile(mobile+<span class="number">2</span>*i);</span><br><span class="line">            s1.setCorpName(companies.get(i%<span class="number">5</span>));</span><br><span class="line">            s1.setSmsContent(SmsLogs.doc.substring((i-<span class="number">1</span>)*<span class="number">20</span>,i*<span class="number">20</span>));</span><br><span class="line">            s1.setState(i%<span class="number">2</span>);</span><br><span class="line">            s1.setOperatorId(i%<span class="number">3</span>);</span><br><span class="line">            s1.setProvince(provinces.get(i%<span class="number">4</span>));</span><br><span class="line">            s1.setIpAddr(<span class="string">&quot;127.0.0.&quot;</span>+i);</span><br><span class="line">            s1.setReplyTotal(i*<span class="number">3</span>);</span><br><span class="line">            s1.setFee(i*<span class="number">6</span>+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            String json1  = mapper.writeValueAsString(s1);</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> IndexRequest(index,type,s1.getId().toString()).source(json1, XContentType.JSON));</span><br><span class="line">            System.out.println(<span class="string">&quot;数据&quot;</span>+i+s1.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.client 执行</span></span><br><span class="line">        BulkResponse responses = client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.输出结果</span></span><br><span class="line">        System.out.println(responses.getItems().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="六、ElasticSearch的各种查询"><a href="#六、ElasticSearch的各种查询" class="headerlink" title="六、ElasticSearch的各种查询"></a>六、ElasticSearch的各种查询</h1><h3 id="6-1、term-amp-terms查询"><a href="#6-1、term-amp-terms查询" class="headerlink" title="6.1、term&amp;terms查询"></a>6.1、term&amp;terms查询</h3><h5 id="6-1-1、term查询"><a href="#6-1-1、term查询" class="headerlink" title="6.1.1、term查询"></a>6.1.1、term查询</h5><blockquote>
<p>term的查询代表是完全匹配，搜索之前不会对你搜索的关键词进行分词，直接去文档分词库中匹配内容。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 0,	# limit 的第一个 ？  </span><br><span class="line">  &quot;size&quot;: 5,	# limit 的第二个 ？   这两个用来分页</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;province&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;上海&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现方式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">termQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建request对象，基本所有的查询都使用SearchRequest</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件,并将查询条件封装到Request对象中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.from(<span class="number">0</span>);</span><br><span class="line">        builder.size(<span class="number">5</span>);</span><br><span class="line">        builder.query(QueryBuilders.termQuery(<span class="string">&quot;province&quot;</span>,<span class="string">&quot;上海&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Clinet执行</span></span><br><span class="line">        SearchResponse search = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-1-2、terms查询"><a href="#6-1-2、terms查询" class="headerlink" title="6.1.2、terms查询"></a>6.1.2、terms查询</h5><blockquote>
<p>terms和term的查询机制是一样的，都不会将指定的关键字进行分词，直接去分词库中匹配内容，找到相应的结果并返回。</p>
<p>terms是针对一个字段可能是多个值的时候使用。</p>
<p>term类似MySql中的：where   province = “上海”；</p>
<p>terms类似MySql中的：where   province = “上海” or  where   province = “北京”   or    where   province = “广州”；</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># terms查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;from&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;province&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;上海&quot;</span>,</span><br><span class="line">        <span class="string">&quot;北京&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现方式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// terms查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">termsQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并封装到Request对象中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.from(<span class="number">0</span>);</span><br><span class="line">        builder.size(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 指定多个查询条件</span></span><br><span class="line">        builder.query(QueryBuilders.termsQuery(<span class="string">&quot;province&quot;</span>,<span class="string">&quot;上海&quot;</span>,<span class="string">&quot;北京&quot;</span>));</span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、获得结果遍历</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-2、match查询"><a href="#6-2、match查询" class="headerlink" title="6.2、match查询"></a>6.2、match查询</h3><blockquote>
<p>match查询属于高级查询，他会根据你查询的字段类型不一样，采用不同的查询方式。</p>
<ul>
<li>查询是日期或者是数值的话，它会将基于你的字符串查询内容转换为日期或者数值对待。</li>
<li>如果查询的是一个不被分词的内容(keyword)，match查询不会对你查询的关键字进行分词。</li>
<li>如果查询的内容是一个可以被分词的内容(text)，，match查询会将你指定的查询内容根据一定的方式去分词，去分词库中匹配指定的内容。</li>
</ul>
<p>match查询，实际底层就是多个term查询，将多个term查询的结果封装到了一起。</p>
</blockquote>
<h5 id="6-2-1、match-all查询"><a href="#6-2-1、match-all查询" class="headerlink" title="6.2.1、match_all查询"></a>6.2.1、match_all查询</h5><blockquote>
<p>查询全部内容，不指定查询条件</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># match_all查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// match_all 查询</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo6</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// match_all 查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">matchALLQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并封装到Request对象中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.from(<span class="number">0</span>);</span><br><span class="line">        builder.size(<span class="number">10</span>);       <span class="comment">// ES默认值显示10条数据，如需展示更多，需要手动指定Size的大小</span></span><br><span class="line">        builder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">        </span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client对象执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;一共查询到&quot;</span>+resp.getHits().getHits().length+<span class="string">&quot;条数据！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-2-2、match查询"><a href="#6-2-2、match查询" class="headerlink" title="6.2.2、match查询"></a>6.2.2、match查询</h5><blockquote>
<p>指定一个Filed做为查询条件</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># match查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span>: <span class="string">&quot;踏歌行&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// match查询</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo6</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// match 查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">matchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并封装到Request对象中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">           </span><br><span class="line">        <span class="comment">//------------------------------------------------------</span></span><br><span class="line">        builder.query(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;青铜古棺&quot;</span>));</span><br><span class="line">        <span class="comment">//------------------------------------------------</span></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client对象执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;一共查询到&quot;</span>+resp.getHits().getHits().length+<span class="string">&quot;条数据！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-2-3、布尔match查询"><a href="#6-2-3、布尔match查询" class="headerlink" title="6.2.3、布尔match查询"></a>6.2.3、布尔match查询</h5><blockquote>
<p>基于一个Filed匹配的内容，采用and或者or的方式进行连接查询</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 布尔match查询,基于 and</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;青铜古棺 太空探测&quot;</span></span><br><span class="line">        , <span class="attr">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span>		# 基于 and 连接，查询的内容既包括青铜古棺，又包括太空探测。</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 布尔match查询，基于 or</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;青铜古棺 太空探测&quot;</span>		# 基于 and 连接，查询的内容是青铜古棺，也可以是太空探测。</span><br><span class="line">        , <span class="attr">&quot;operator&quot;</span>: <span class="string">&quot;or&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo6</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// booleanMatch 查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">booleanMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并封装到Request对象中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        <span class="comment">// ES默认值显示10条数据，如需展示更多，需要手动指定Size的大小</span></span><br><span class="line">        <span class="comment">//------------------------------------------------------</span></span><br><span class="line">        builder.query(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;青铜古棺 太空探</span></span><br><span class="line"><span class="string">                                               // 选择 AND 或者 OR</span></span><br><span class="line"><span class="string">                                               测&quot;</span>).operator(Operator.AND));  </span><br><span class="line">        <span class="comment">//------------------------------------------------</span></span><br><span class="line">          request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client对象执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-2-4、multi-match查询"><a href="#6-2-4、multi-match查询" class="headerlink" title="6.2.4、multi_match查询"></a>6.2.4、multi_match查询</h5><blockquote>
<p>match是在一个Filed中筛选关键字，multi_match是一个关键字在多个Filed中查询</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># multi_match查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;上海&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: [<span class="string">&quot;province&quot;</span>,<span class="string">&quot;smsContent&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo6</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multiMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定条件，添加进request</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.multiMatchQuery(<span class="string">&quot;上海&quot;</span>,<span class="string">&quot;province&quot;</span>,<span class="string">&quot;smsContent&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;一共查询到&quot;</span>+resp.getHits().getHits().length+<span class="string">&quot;条数据！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-3、其它查询"><a href="#6-3、其它查询" class="headerlink" title="6.3、其它查询"></a>6.3、其它查询</h3><h5 id="6-3-1、id查询"><a href="#6-3-1、id查询" class="headerlink" title="6.3.1、id查询"></a>6.3.1、id查询</h5><blockquote>
<p>根据id查询，类似MySql中 where id = ？</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 根据id查询</span><br><span class="line">GET /sms-logs-index/sms-logs-type/1</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fingById</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建GetRequest</span></span><br><span class="line">        GetRequest request = <span class="keyword">new</span> GetRequest(index,type,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、执行查询</span></span><br><span class="line">        GetResponse resp = client.get(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、遍历查询后的结果</span></span><br><span class="line">        Map&lt;String, Object&gt; map = resp.getSourceAsMap();</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-2、ids查询"><a href="#6-3-2、ids查询" class="headerlink" title="6.3.2、ids查询"></a>6.3.2、ids查询</h5><blockquote>
<p>根据多个id查询，类似MySql中 where id in (1,2,3….)</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 根据ids查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ids&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;values&quot;</span>: [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIds</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并添加到request中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.idsQuery().addIds(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client查询</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-3、prefix查询"><a href="#6-3-3、prefix查询" class="headerlink" title="6.3.3、prefix查询"></a>6.3.3、prefix查询</h5><blockquote>
<p>前缀查询，指定一段关键字做为前缀，从而查询以关键字开头的文档</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># prefix查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;海尔&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// prefix 前缀查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prefixQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并添加到request中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.prefixQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;海尔&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client查询</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-4、fuzzy查询"><a href="#6-3-4、fuzzy查询" class="headerlink" title="6.3.4、fuzzy查询"></a>6.3.4、fuzzy查询</h5><blockquote>
<p>模糊查询，我们输入字符的大概，ES会根据输入的内容大概匹配一下结果</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># fuzzy查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;fuzzy&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;海尔电集&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;prefix_length&quot;</span>: <span class="number">3</span>		# 用来指定前面几个字符是不能出现错误的</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fuzzy 模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fuzzyQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并添加到request中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.fuzzyQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;海尔电集&quot;</span>).prefixLength(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client查询</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-5、wildcard查询"><a href="#6-3-5、wildcard查询" class="headerlink" title="6.3.5、wildcard查询"></a>6.3.5、wildcard查询</h5><blockquote>
<p>通配查询，和MySql中的like是一个东西。可以在查询时，在字符串中通配符 * 和 占位符 ？</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># wildcard 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;wildcard&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;格力*&quot;</span>		# 可以使用 * 和 ？ 指定通配符和占位符</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// wildcard 通配查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">wildCardQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并添加到request中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.wildcardQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;格力*&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过Client查询</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-6、range查询"><a href="#6-3-6、range查询" class="headerlink" title="6.3.6、range查询"></a>6.3.6、range查询</h5><blockquote>
<p>范围查询，只针对数值类型，对一个Filed进行大于或者小于范围</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># range 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;fee&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;gte&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;lte&quot;</span>: <span class="number">20</span></span><br><span class="line">          # 可以使用 gt：&gt;		gte:&gt;=		lt:&lt;		lte:&lt;=</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// range 范围查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rangeQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并将其添加至Request</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.rangeQuery(<span class="string">&quot;fee&quot;</span>).gt(<span class="number">10</span>).lt(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行查询</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-7、regexp查询"><a href="#6-3-7、regexp查询" class="headerlink" title="6.3.7、regexp查询"></a>6.3.7、regexp查询</h5><blockquote>
<p>正则查询 ，通过你编写的正则表达式去匹配内容</p>
<p>PS：<a href="">prefix、fuzzy、wildcard 和 regexp 的查询效率相对比较低，在要求高效率的时候，尽量避免使用。</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># regexp 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;regexp&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;mobile&quot;</span>: <span class="string">&quot;138[0-9]&#123;7&#125;&quot;</span>		# 编写正则表达式</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JAVA 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo8</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line"></span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// regexp 查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">regexpQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定查询条件，并将其添加到request对象中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.regexpQuery(<span class="string">&quot;mobile&quot;</span>,<span class="string">&quot;138[0-9]&#123;7&#125;&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回的结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="6-4、深分页Scroll"><a href="#6-4、深分页Scroll" class="headerlink" title="6.4、深分页Scroll"></a>6.4、深分页Scroll</h3><blockquote>
<p>ES对 from+Size是有限制的，from和size之和不能超过1w，超过后效率非常低。</p>
<p>原理：</p>
<p>from+size在ES查询数据的方式：</p>
<ul>
<li>第一步、将用户输入的关键字进行分词。</li>
<li>第二步、去分词库中进行检索，得到文档id。</li>
<li>第三步、去各个分片中拉取指定的数据(耗时较长)。</li>
<li>第四步、数据根据分数(score)进行排序(耗时较长)。</li>
<li>第五步、根据from的起始值，舍弃起始值之前的数据。</li>
<li>第六步、返回结果。</li>
</ul>
<p>Scroll+size在ES查询数据的方式：</p>
<ul>
<li>第一步、将用户输入的关键字进行分词。</li>
<li>第二步、去分词库中进行检索，得到文档id。</li>
<li>第三步、将文档的id存放在ES的上下文中，</li>
<li>第四步、根据你指定的size的个数去ES中检索指定个数的数据，拿完数据的文档id，会从上下文中移除。</li>
<li>第五步、如果需要下一页的内容，直接去上下文中找后续的内容。</li>
<li>第六步、循环第四步和第五步</li>
</ul>
<p><a href="">Scroll 查询方式、不适合做实时查询，因为他是查询后放在内存，只是根据size的大小来拿出一部分，下一页的话还是去内存拿查好的，直到拿完。</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 执行scroll 查询，返回第一页数据，并且将文档id存放在上下文中</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search?scroll=1m		# 指定文档的生存时间，1m=1分钟</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;:2,				# 每次查询的条数</span><br><span class="line">  &quot;sort&quot;:[				# 排序，根据指定的字段进行排序 </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;fee&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;order&quot;</span>:<span class="string">&quot;desc&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 根据scroll查询下一页数据</span><br><span class="line">POST /_search/scroll</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scroll_id&quot;</span>:			# 根据第一步得到的scroll_id去指定</span><br><span class="line">  <span class="string">&quot;DnF1ZXJ5VGhlbkZldGNoAwAAAAAAAG6CFkNpUS0yRnNxU2g2bU9JQjBGWTNJV0EAAAAAAABugRZDaVEtMkZzcVNoNm1PSUIwRlkzSVdBAAAAAAAAboMWQ2lRLTJGc3FTaDZtT0lCMEZZM0lXQQ==&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scroll&quot;</span>:<span class="string">&quot;1m&quot;</span>			# scroll 的生存时间</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 删除scroll在上下文中的数据</span><br><span class="line">DELETE /_search/scroll/		# scroll的id</span><br><span class="line">DnF1ZXJ5VGhlbkZldGNoAwAAAAAAAG6CFkNpUS0yRnNxU2g2bU9JQjBGWTNJV0EAAAAAAABugRZDaVEtMkZzcVNoNm1PSUIwRlkzSVdBAAAAAAAAboMWQ2lRLTJGc3FTaDZtT0lCMEZZM0lXQQ==</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现scroll查询、scroll下一页、删除scroll</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Scroll 查询</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo9</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定scroll的生存时间</span></span><br><span class="line">        request.scroll(TimeValue.timeValueMinutes(<span class="number">1L</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、指定查询条件，并添加到request中</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.matchAllQuery());   <span class="comment">// 查询条件</span></span><br><span class="line">        builder.size(<span class="number">3</span>);    <span class="comment">// 每次查多少条</span></span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、通过Client执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、获得Scroll_id</span></span><br><span class="line">        String scroll_Id = resp.getScrollId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、返回结果</span></span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------首页---------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">    <span class="comment">// scroll 下一页</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 7、创建SearchScrollRequest,开始下一页</span></span><br><span class="line">            SearchScrollRequest scrollRequest = <span class="keyword">new</span> SearchScrollRequest(scroll_Id);</span><br><span class="line">            <span class="comment">// 指定Scroll的生存时间</span></span><br><span class="line">            scrollRequest.scroll(TimeValue.timeValueMinutes(<span class="number">1L</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 8、执行查询，返回结果</span></span><br><span class="line">            SearchResponse searchResponse = client.scroll(scrollRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 9、是否最后一下，是否查到了数据</span></span><br><span class="line">            SearchHit[] hits = searchResponse.getHits().getHits();</span><br><span class="line">            <span class="keyword">if</span> (hits != <span class="keyword">null</span> &amp;&amp; hits.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;------------------------下一页---------------------&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (SearchHit hit : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">                    Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">                    System.out.println(sourceAsMap);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;------------------------没有更多了---------------------&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">    <span class="comment">// scroll 删除 </span></span><br><span class="line">    </span><br><span class="line">    		<span class="comment">// 10、创建clearScroll</span></span><br><span class="line">        ClearScrollRequest clearScrollRequest = <span class="keyword">new</span> ClearScrollRequest();</span><br><span class="line">            <span class="comment">// 11、指定scroll_id</span></span><br><span class="line">        clearScrollRequest.addScrollId(scroll_Id);</span><br><span class="line">            <span class="comment">// 12、在上下文中删除scroll</span></span><br><span class="line">        client.clearScroll(clearScrollRequest,RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-5、delete-by-query"><a href="#6-5、delete-by-query" class="headerlink" title="6.5、delete-by-query"></a>6.5、delete-by-query</h3><blockquote>
<p>根据term、match等方式查询删除文档，将查询出来的文档删除</p>
<p>ps：</p>
<p><a href="">如果你需要删除的内容，是index下的大部分内容，推荐创建一个全新的index，将需要保留的内容添加进全新的索引。</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># delete-by-query</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;fee&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;gte&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;lte&quot;</span>: <span class="number">20</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo10</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delteByQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建deleteByQuery</span></span><br><span class="line">        DeleteByQueryRequest deleteByQueryRequest = <span class="keyword">new</span> DeleteByQueryRequest(index);</span><br><span class="line">        deleteByQueryRequest.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定检索条件         和SearchRequest指定检索条件不一样</span></span><br><span class="line">        deleteByQueryRequest.setQuery(QueryBuilders.rangeQuery(<span class="string">&quot;fee&quot;</span>).gte(<span class="number">10</span>).lte(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行删除</span></span><br><span class="line">        BulkByScrollResponse bulkByScrollResponse = client.deleteByQuery(deleteByQueryRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出返回结果</span></span><br><span class="line">        System.out.println(bulkByScrollResponse.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-6、复合查询"><a href="#6-6、复合查询" class="headerlink" title="6.6、复合查询"></a>6.6、复合查询</h3><h5 id="6-6-1、bool查询"><a href="#6-6-1、bool查询" class="headerlink" title="6.6.1、bool查询"></a>6.6.1、bool查询</h5><blockquote>
<p>复合过滤器，将你的多个查询条件以一定的逻辑 组合在一起</p>
<ul>
<li>must：所有的条件以must组合在一起，表示 and 的意思。</li>
<li>must_not：将must_not中的条件，全部都不能匹配，表示 not 的意思。</li>
<li>should：所有的条件用 should 组合在一起表示 or 的意思。</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 查询城市为上海或者北京</span><br><span class="line"># 运营商不能是联通</span><br><span class="line"># smscontent必须包含一口和太空</span><br><span class="line"># bool查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;should&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;province&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;上海&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;province&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;北京&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;operatorId&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;2&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;smsContent&quot;</span>: <span class="string">&quot;九龙&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;smsContent&quot;</span>: <span class="string">&quot;拉棺&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo11</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">boolQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、添加执行条件</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="comment">// 查询城市为上海或者北京</span></span><br><span class="line">        boolQuery.should(QueryBuilders.termQuery(<span class="string">&quot;province&quot;</span>,<span class="string">&quot;上海&quot;</span>));</span><br><span class="line">        boolQuery.should(QueryBuilders.termQuery(<span class="string">&quot;province&quot;</span>,<span class="string">&quot;北京&quot;</span>));</span><br><span class="line">        <span class="comment">// 运营商不能是联通</span></span><br><span class="line">        boolQuery.mustNot(QueryBuilders.termQuery(<span class="string">&quot;operatorId&quot;</span>,<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        <span class="comment">//smscontent必须包含九龙和拉棺</span></span><br><span class="line">        boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;九龙&quot;</span>));</span><br><span class="line">        boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;拉棺&quot;</span>));</span><br><span class="line">        <span class="comment">// 把boolQuery添加进builder</span></span><br><span class="line">        builder.query(boolQuery);</span><br><span class="line">        <span class="comment">// 把检索条件添加进Request</span></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行操作</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-6-2、boosting查询"><a href="#6-6-2、boosting查询" class="headerlink" title="6.6.2、boosting查询"></a>6.6.2、boosting查询</h5><blockquote>
<p>boosting 查询可以帮助我们去影响查询后的score</p>
<ul>
<li>postive：postive中查询得到的内容，才会返回结果集。</li>
<li>negative：如果negative中查询的内容匹配，并且postive中查询的内容也匹配。我们可以操控negative_boost的指定系数，从而降低文档的score，查询结果的排序也会降低</li>
<li>negative_boost：指定系数，必须小于1.0.</li>
</ul>
<p>关于查询时文档的score时怎么计算的：</p>
<ul>
<li>搜索的关键字在文档中出现的频次越高，分数越高。</li>
<li>指定的文档内容越短，分数越高。</li>
<li>搜索时，指定的关键字会被分词，这个分词的内容，在分词库 中匹配的越多，分数越高。</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># boosting 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;boosting&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;positive&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span>: <span class="string">&quot;九龙拉棺&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;negative&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span>: <span class="string">&quot;上古&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;negative_boost&quot;</span>: <span class="number">0.2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo11</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// boosting 查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">boostingQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、添加执行条件</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        BoostingQueryBuilder boostingQueryBuilder = QueryBuilders.boostingQuery(</span><br><span class="line">                QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>, <span class="string">&quot;九龙拉棺&quot;</span>),</span><br><span class="line">                QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>, <span class="string">&quot;上古&quot;</span>)</span><br><span class="line">        ).negativeBoost(<span class="number">0.5f</span>);</span><br><span class="line">        <span class="comment">// 把boostingQueryBuilder添加进builder</span></span><br><span class="line">        builder.query(boostingQueryBuilder);</span><br><span class="line">        <span class="comment">// 把检索条件添加进Request</span></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行操作</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="6-7、filter查询"><a href="#6-7、filter查询" class="headerlink" title="6.7、filter查询"></a>6.7、filter查询</h3><blockquote>
<p>query：根据你查询的条件，去计算文档匹配度得到一个分数，并且根据分数进行排序，不会做缓存。</p>
<p>filter：根据你的查询条件去查询文档，不会去计算分数，而且filter会对经常过滤的数据进行缓存</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># filter 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;trem&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;corpName&quot;</span>:<span class="string">&quot;格力汽车&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;range&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;fee&quot;</span>:&#123;</span><br><span class="line">              <span class="attr">&quot;lte&quot;</span>:<span class="number">4</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo12</span> </span>&#123;</span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// # filter 查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filterQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建SearchRequest对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、添加执行条件</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;格力汽车&quot;</span>));</span><br><span class="line">        boolQuery.filter(QueryBuilders.rangeQuery(<span class="string">&quot;fee&quot;</span>).lte(<span class="number">4</span>));</span><br><span class="line">        <span class="comment">// 把boolQuery添加进builder</span></span><br><span class="line">        builder.query(boolQuery);</span><br><span class="line">        <span class="comment">// 把检索条件添加进Request</span></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行操作</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、遍历返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; result = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="6-8、高亮查询"><a href="#6-8、高亮查询" class="headerlink" title="6.8、高亮查询"></a>6.8、高亮查询</h3><blockquote>
<p>高亮查询就是将用户输入的关键字，查询后，以特殊的样式返回在结果中。</p>
<p>高亮展示的数据，本身就是文档的一个Filed，单独将Filed以highlight的形式返回</p>
<p>ES中提供了一个highlight属性，用来高亮，和query同级别：</p>
<ul>
<li>fragment_size：高亮查询返回多少个字符</li>
<li>pre_tags：指定前缀标签，例如：<font color=red></li>
<li>post_tags：指定后缀标签，例如：</font></li>
<li>fileds：指定哪几个Filed字段以高亮形式返回</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 高亮查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span>: <span class="string">&quot;九龙拉棺&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;pre_tags&quot;</span>: <span class="string">&quot;&lt;font color=red&gt;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;post_tags&quot;</span>: <span class="string">&quot;&lt;/font&gt;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fragment_size&quot;</span>:<span class="number">10</span></span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 高亮查询</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo13</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highLightQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request对象</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line">        <span class="comment">// 2、指定查询条件和高亮</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.query(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;九龙拉棺&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定高亮</span></span><br><span class="line">        HighlightBuilder highlightBuilder = <span class="keyword">new</span> HighlightBuilder();</span><br><span class="line">        highlightBuilder.field(<span class="string">&quot;smsContent&quot;</span>,<span class="number">10</span>);</span><br><span class="line">        highlightBuilder.preTags(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;&quot;</span>);</span><br><span class="line">        highlightBuilder.postTags(<span class="string">&quot;&lt;font&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        builder.highlighter(highlightBuilder);</span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出高亮结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">            System.out.println(highlightFields.get(<span class="string">&quot;smsContent&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-9、聚合查询"><a href="#6-9、聚合查询" class="headerlink" title="6.9、聚合查询"></a>6.9、聚合查询</h3><blockquote>
<p>ES的聚合查询和MySql的类似，但是要比MySql的丰富。</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 聚合查询，RestFul语法</span><br><span class="line">POST /index/type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;聚合查询的名字(随意取)&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;cardinality(不同聚合函数的名字)&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;属性&quot;</span>: <span class="string">&quot;值&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-9-1、去重计数"><a href="#6-9-1、去重计数" class="headerlink" title="6.9.1、去重计数"></a>6.9.1、去重计数</h5><blockquote>
<p>在一次查询中，每条数据都有自己的省份，现在要统计不同的省份一共出现了几次？数据中有很多条可能省份都一样，我们需要去掉重复出现的，再统计一共出现了多少次。</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 聚合查询，去重计数</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;agg&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;cardinality&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;province&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚合查询,去重计数</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo14</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cardinalityQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line">        <span class="comment">// 2、指定聚合查询的方式</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.aggregation(AggregationBuilders.cardinality(<span class="string">&quot;agg&quot;</span>).field(<span class="string">&quot;province&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出聚合查询的结果</span></span><br><span class="line">        Cardinality agg = resp.getAggregations().get(<span class="string">&quot;agg&quot;</span>);</span><br><span class="line">        System.out.println(agg.getValue());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="6-9-2、范围统计"><a href="#6-9-2、范围统计" class="headerlink" title="6.9.2、范围统计"></a>6.9.2、范围统计</h5><blockquote>
<p>统计一定范围内文档出现的个数</p>
<p>统计可以针对数值类行，也可以针对日期类型，也可以针对ip类型</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># 聚合查询，范围内个数统计,数值类型</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">   <span class="attr">&quot;agg&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;ranges&quot;</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;from&quot;</span>: <span class="number">0</span>,</span><br><span class="line">           <span class="attr">&quot;to&quot;</span>: <span class="number">10</span></span><br><span class="line">         &#125;</span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 聚合查询，范围内个数统计,日期类型</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">   <span class="attr">&quot;agg&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;date_range&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;createDate&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;yyyy-MM-dd&quot;</span>, </span><br><span class="line">       <span class="attr">&quot;ranges&quot;</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;from&quot;</span>: <span class="string">&quot;2000-01-01&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;to&quot;</span>: <span class="string">&quot;2020-12-30&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;from&quot;</span>: <span class="string">&quot;2000-01-01&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;to&quot;</span>: <span class="string">&quot;2020-01-01&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 聚合查询，范围内个数统计,IP类型</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">   <span class="attr">&quot;agg&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;ip_range&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;ipAddr&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;ranges&quot;</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;from&quot;</span>: <span class="string">&quot;127.0.0.0&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;to&quot;</span>: <span class="string">&quot;127.0.0.30&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;from&quot;</span>: <span class="string">&quot;127.0.0.0&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;to&quot;</span>: <span class="string">&quot;127.0.0.10&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚合函数 范围统计</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo15</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rangeQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定聚合函数查询方式</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.aggregation(AggregationBuilders.range(<span class="string">&quot;agg&quot;</span>).field(<span class="string">&quot;id&quot;</span>).addRange(<span class="number">0</span>,<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">        Range agg = resp.getAggregations().get(<span class="string">&quot;agg&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Range.Bucket bucket : agg.getBuckets()) &#123;</span><br><span class="line">            String key = bucket.getKeyAsString();</span><br><span class="line">            Object from = bucket.getFrom();</span><br><span class="line">            Object to = bucket.getTo();</span><br><span class="line">            <span class="keyword">long</span> docCount = bucket.getDocCount();</span><br><span class="line">            System.out.println(<span class="string">&quot;key:--&gt;&quot;</span>+key);</span><br><span class="line">            System.out.println(<span class="string">&quot;from:--&gt;&quot;</span>+from);</span><br><span class="line">            System.out.println(<span class="string">&quot;to:--&gt;&quot;</span>+to);</span><br><span class="line">            System.out.println(<span class="string">&quot;docCount:--&gt;&quot;</span>+docCount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-9-3、统计聚合"><a href="#6-9-3、统计聚合" class="headerlink" title="6.9.3、统计聚合"></a>6.9.3、统计聚合</h5><blockquote>
<p>它可以帮你查询指定Filed的最大值、最小值、平均值、平方和 ……..</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 聚合查询，统计聚合</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;agg&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;extended_stats&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;id&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 代码实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚合函数 范围统计</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo15</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;sms-logs-index&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;sms-logs-type&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendedStatsQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建Request</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定聚合函数查询方式</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        builder.aggregation(AggregationBuilders.extendedStats(<span class="string">&quot;agg&quot;</span>).field(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">        ExtendedStats agg = resp.getAggregations().get(<span class="string">&quot;agg&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> max = agg.getMax();</span><br><span class="line">        <span class="keyword">double</span> min = agg.getMin();</span><br><span class="line">        System.out.println(<span class="string">&quot;最大值为：&quot;</span>+max);</span><br><span class="line">        System.out.println(<span class="string">&quot;最小值为：&quot;</span>+min);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="6-10、地图经纬度搜索"><a href="#6-10、地图经纬度搜索" class="headerlink" title="6.10、地图经纬度搜索"></a>6.10、地图经纬度搜索</h3><blockquote>
<p>ES中提供了一种 geo_point 的数据类型来存储经纬度。</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 因为没有，我们可以创建一个简单的带 geo_point 的index</span><br><span class="line"></span><br><span class="line"># 创建一个带 geo_point 的 index</span><br><span class="line">PUT /map</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span>: <span class="number">5</span>, </span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;map&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>:&#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;location&quot;</span>:&#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;geo_point&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 添加数据</span><br><span class="line"></span><br><span class="line">POST /map/map/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;天安门&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;location&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;lon&quot;</span>:<span class="number">116.403874</span>,</span><br><span class="line">    <span class="attr">&quot;lat&quot;</span>:<span class="number">39.915129</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /map/map/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;海定公园&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;location&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;lon&quot;</span>:<span class="number">116.301314</span>,</span><br><span class="line">    <span class="attr">&quot;lat&quot;</span>:<span class="number">39.99319</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /map/map/3</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;北京动物园&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;location&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;lon&quot;</span>:<span class="number">116.343283</span>,</span><br><span class="line">    <span class="attr">&quot;lat&quot;</span>:<span class="number">39.949175</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-10-1、ES中地图的检索方式"><a href="#6-10-1、ES中地图的检索方式" class="headerlink" title="6.10.1、ES中地图的检索方式"></a>6.10.1、ES中地图的检索方式</h5><blockquote>
<ul>
<li>geo_distance：确定一个点搜索半径范围内的所有数据。</li>
<li>geo_bounding_box：以两个点确定一个矩形，获取矩形内所有的数据。</li>
<li>geo_polygon：以多个点确定一个多边形，获取多边形内的全部数据。</li>
</ul>
</blockquote>
<p><strong>geo_distance：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># geo_distance 查询</span><br><span class="line">POST /map/map/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;geo_distance&quot;</span>: &#123;</span><br><span class="line">      &quot;location&quot;: &#123;             # 确定一个点</span><br><span class="line">        &quot;lon&quot;:116.365705,</span><br><span class="line">        &quot;lat&quot;:39.909781</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;distance&quot;:4000,		   # 确定半径范围</span><br><span class="line">      &quot;distance_type&quot;:&quot;arc&quot;	    # 指定搜索的形状为圆形</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>geo_bounding_box：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># geo_bounding_box 查询</span><br><span class="line">POST /map/map/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;geo_bounding_box&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;location&quot;</span>: &#123;</span><br><span class="line">          &quot;top_left&quot;:&#123;			# 左上坐标点</span><br><span class="line">            &quot;lon&quot;:116.238504,</span><br><span class="line">            &quot;lat&quot;:40.043363</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;bottom_right&quot;:&#123;		# 右下坐标点</span><br><span class="line">            &quot;lon&quot;:116.492905,</span><br><span class="line">            &quot;lat&quot;:39.799223</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>geo_polygon：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># geo_polyon 查询</span><br><span class="line">POST /map/map/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;geo_polygon&quot;</span>:&#123;</span><br><span class="line">       <span class="attr">&quot;location&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;points&quot;</span>:[				# 确定多个点</span><br><span class="line">         &#123;</span><br><span class="line">            <span class="attr">&quot;lon&quot;</span>:<span class="number">116.408248</span>,</span><br><span class="line">            <span class="attr">&quot;lat&quot;</span>:<span class="number">39.968643</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;lon&quot;</span>:<span class="number">116.310225</span>,</span><br><span class="line">            <span class="attr">&quot;lat&quot;</span>:<span class="number">39.879224</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">&quot;lon&quot;</span>:<span class="number">116.50081</span>,</span><br><span class="line">            <span class="attr">&quot;lat&quot;</span>:<span class="number">39.874351</span></span><br><span class="line">         &#125;</span><br><span class="line">         ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="6-11、基于geo-polygon使用Java实现查询"><a href="#6-11、基于geo-polygon使用Java实现查询" class="headerlink" title="6.11、基于geo_polygon使用Java实现查询"></a>6.11、基于geo_polygon使用Java实现查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 地图检索</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo16</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RestHighLevelClient client =  ESClint.getClient();</span><br><span class="line">    String index = <span class="string">&quot;map&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;map&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">geoQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、常见SearchRequest</span></span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定检索条件</span></span><br><span class="line">        SearchSourceBuilder builder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        <span class="comment">// 添加三个坐标</span></span><br><span class="line">        ArrayList&lt;GeoPoint&gt; points = <span class="keyword">new</span> ArrayList&lt;GeoPoint&gt;();</span><br><span class="line">        points.add(<span class="keyword">new</span> GeoPoint(<span class="number">39.968643</span>,<span class="number">116.408248</span>));</span><br><span class="line">        points.add(<span class="keyword">new</span> GeoPoint(<span class="number">39.879224</span>,<span class="number">116.310225</span>));</span><br><span class="line">        points.add(<span class="keyword">new</span> GeoPoint(<span class="number">39.874351</span>,<span class="number">116.50081</span>));</span><br><span class="line">        builder.query(QueryBuilders.geoPolygonQuery(<span class="string">&quot;location&quot;</span>,points));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、执行</span></span><br><span class="line">        SearchResponse resp = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、输出</span></span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsMap());</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">云雀</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://xurongchang.github.io/posts/f14ce4db/">https://xurongchang.github.io/posts/f14ce4db/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://xurongchang.github.io" target="_blank">Lan's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/quehua/blogimg/raw/master/img/20201211173025.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/5bd9b965/"><img class="prev-cover" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/5.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git笔记</div></div></a></div><div class="next-post pull-right"><a href="/posts/b5c2b25e/"><img class="next-cover" data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211154953.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">提取Wallpaper Engine中的壁纸</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/91.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">云雀</div><div class="author-info__description">要让事情改变，先改变自己;要让事情变得更好，先让自己变得更强。</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" href="https://xurongchang.github.io/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xurongchang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:quehua.hb@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Rss"><i class="fas fa-rss"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">谢谢帅气|漂亮的你来到我的博客，搭建博客的原因只想记录自己学习和日常。如果喜欢，欢迎收藏哦！</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81ElasticSearch%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、ElasticSearch介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%BC%95%E8%A8%80"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.1 引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-ES%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.0.2.</span> <span class="toc-text">1.2 ES的介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-ES%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">1.0.3.</span> <span class="toc-text">1.3 ES的由来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-ES%E5%92%8CSolr%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.4.</span> <span class="toc-text">1.4 ES和Solr的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">1.0.5.</span> <span class="toc-text">1.5 倒排索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ElaticSearch%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、ElaticSearch安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E3%80%81%E5%AE%89%E8%A3%85ES-amp-Kibana"><span class="toc-number">2.0.1.</span> <span class="toc-text">2.1 、安装ES &amp; Kibana</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E3%80%81%E5%AE%89%E8%A3%85-IK-%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.2 、安装 IK 分词器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81ElasticSearch%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">三、ElasticSearch基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81ES%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">3.0.1.</span> <span class="toc-text">3.1、ES的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-%E3%80%81%E7%B4%A2%E5%BC%95Index%E3%80%81%E5%88%86%E7%89%87%E5%92%8C%E5%A4%87%E4%BB%BD%E3%80%82"><span class="toc-number">3.0.1.0.1.</span> <span class="toc-text">3.1.1 、索引Index、分片和备份。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-2-%E3%80%81%E7%B1%BB%E5%9E%8BType"><span class="toc-number">3.0.1.0.2.</span> <span class="toc-text">3.1.2 、类型Type</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-3-%E3%80%81%E6%96%87%E6%A1%A3Doc"><span class="toc-number">3.0.1.0.3.</span> <span class="toc-text">3.1.3 、文档Doc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E3%80%81%E6%93%8D%E4%BD%9CES%E7%9A%84Restful%E8%AF%AD%E6%B3%95"><span class="toc-number">3.0.2.</span> <span class="toc-text">3.2 、操作ES的Restful语法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-4-%E3%80%81%E5%B1%9E%E6%80%A7Filed"><span class="toc-number">3.0.2.0.1.</span> <span class="toc-text">3.1.4 、属性Filed</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.0.3.</span> <span class="toc-text">3.3、 索引的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number">3.0.3.0.1.</span> <span class="toc-text">3.3.1 、创建一个索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-2-%E3%80%81%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF"><span class="toc-number">3.0.3.0.2.</span> <span class="toc-text">3.3.2 、查看索引信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-%E3%80%81%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">3.0.3.0.3.</span> <span class="toc-text">3.3.3 、删除索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81ES%E4%B8%AD-Filed-%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.0.4.</span> <span class="toc-text">3.4、ES中 Filed 可以指定的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E3%80%81%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%B9%B6%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.0.5.</span> <span class="toc-text">3.5、创建索引并指定数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6%E3%80%81%E6%96%87%E6%A1%A3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.0.6.</span> <span class="toc-text">3.6、文档的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-1%E3%80%81%E6%96%B0%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">3.0.6.0.1.</span> <span class="toc-text">3.6.1、新建文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-2%E3%80%81%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">3.0.6.0.2.</span> <span class="toc-text">3.6.2、修改文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-3%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">3.0.6.0.3.</span> <span class="toc-text">3.6.3、删除文档</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Java%E6%93%8D%E4%BD%9CElasticSearch"><span class="toc-number">4.</span> <span class="toc-text">四、Java操作ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81Java%E8%BF%9E%E6%8E%A5ES"><span class="toc-number">4.0.1.</span> <span class="toc-text">4.1、Java连接ES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81Java%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">4.0.2.</span> <span class="toc-text">4.2、Java创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81%E6%A3%80%E6%9F%A5%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E3%80%81%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">4.0.3.</span> <span class="toc-text">4.3、检查索引是否存在、删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E3%80%81Java%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="toc-number">4.0.4.</span> <span class="toc-text">4.4 、Java操作文档</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-1%E3%80%81%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">4.0.4.0.1.</span> <span class="toc-text">4.4.1、添加文档操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-2%E3%80%81%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">4.0.4.0.2.</span> <span class="toc-text">4.4.2、修改文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-3%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">4.0.4.0.3.</span> <span class="toc-text">4.4.3、删除文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-4%E3%80%81Java%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="toc-number">4.0.4.0.4.</span> <span class="toc-text">4.4.4、Java批量操作文档</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81ElasticSearch%E7%BB%83%E4%B9%A0"><span class="toc-number">5.</span> <span class="toc-text">五、ElasticSearch练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81POJO%E7%B1%BB"><span class="toc-number">5.0.1.</span> <span class="toc-text">5.1、POJO类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%92%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">5.0.2.</span> <span class="toc-text">5.2、创建索引和导入数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81ElasticSearch%E7%9A%84%E5%90%84%E7%A7%8D%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">六、ElasticSearch的各种查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%E3%80%81term-amp-terms%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.1.</span> <span class="toc-text">6.1、term&amp;terms查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-1%E3%80%81term%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.1.0.1.</span> <span class="toc-text">6.1.1、term查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-2%E3%80%81terms%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.1.0.2.</span> <span class="toc-text">6.1.2、terms查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%E3%80%81match%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.2.</span> <span class="toc-text">6.2、match查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-1%E3%80%81match-all%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.2.0.1.</span> <span class="toc-text">6.2.1、match_all查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-2%E3%80%81match%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.2.0.2.</span> <span class="toc-text">6.2.2、match查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3%E3%80%81%E5%B8%83%E5%B0%94match%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.2.0.3.</span> <span class="toc-text">6.2.3、布尔match查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-4%E3%80%81multi-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.2.0.4.</span> <span class="toc-text">6.2.4、multi_match查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3%E3%80%81%E5%85%B6%E5%AE%83%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.</span> <span class="toc-text">6.3、其它查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-1%E3%80%81id%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.1.</span> <span class="toc-text">6.3.1、id查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-2%E3%80%81ids%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.2.</span> <span class="toc-text">6.3.2、ids查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-3%E3%80%81prefix%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.3.</span> <span class="toc-text">6.3.3、prefix查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-4%E3%80%81fuzzy%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.4.</span> <span class="toc-text">6.3.4、fuzzy查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-5%E3%80%81wildcard%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.5.</span> <span class="toc-text">6.3.5、wildcard查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-6%E3%80%81range%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.6.</span> <span class="toc-text">6.3.6、range查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-7%E3%80%81regexp%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.3.0.7.</span> <span class="toc-text">6.3.7、regexp查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4%E3%80%81%E6%B7%B1%E5%88%86%E9%A1%B5Scroll"><span class="toc-number">6.0.4.</span> <span class="toc-text">6.4、深分页Scroll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5%E3%80%81delete-by-query"><span class="toc-number">6.0.5.</span> <span class="toc-text">6.5、delete-by-query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6%E3%80%81%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.6.</span> <span class="toc-text">6.6、复合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-6-1%E3%80%81bool%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.6.0.1.</span> <span class="toc-text">6.6.1、bool查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-6-2%E3%80%81boosting%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.6.0.2.</span> <span class="toc-text">6.6.2、boosting查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7%E3%80%81filter%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.7.</span> <span class="toc-text">6.7、filter查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8%E3%80%81%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.8.</span> <span class="toc-text">6.8、高亮查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9%E3%80%81%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.9.</span> <span class="toc-text">6.9、聚合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-9-1%E3%80%81%E5%8E%BB%E9%87%8D%E8%AE%A1%E6%95%B0"><span class="toc-number">6.0.9.0.1.</span> <span class="toc-text">6.9.1、去重计数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-9-2%E3%80%81%E8%8C%83%E5%9B%B4%E7%BB%9F%E8%AE%A1"><span class="toc-number">6.0.9.0.2.</span> <span class="toc-text">6.9.2、范围统计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-9-3%E3%80%81%E7%BB%9F%E8%AE%A1%E8%81%9A%E5%90%88"><span class="toc-number">6.0.9.0.3.</span> <span class="toc-text">6.9.3、统计聚合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10%E3%80%81%E5%9C%B0%E5%9B%BE%E7%BB%8F%E7%BA%AC%E5%BA%A6%E6%90%9C%E7%B4%A2"><span class="toc-number">6.0.10.</span> <span class="toc-text">6.10、地图经纬度搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-10-1%E3%80%81ES%E4%B8%AD%E5%9C%B0%E5%9B%BE%E7%9A%84%E6%A3%80%E7%B4%A2%E6%96%B9%E5%BC%8F"><span class="toc-number">6.0.10.0.1.</span> <span class="toc-text">6.10.1、ES中地图的检索方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11%E3%80%81%E5%9F%BA%E4%BA%8Egeo-polygon%E4%BD%BF%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.0.11.</span> <span class="toc-text">6.11、基于geo_polygon使用Java实现查询</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1822a0ce/" title="CSS笔记"><img data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS笔记"/></a><div class="content"><a class="title" href="/posts/1822a0ce/" title="CSS笔记">CSS笔记</a><time datetime="2020-12-11T11:11:56.000Z" title="发表于 2020-12-11 19:11:56">2020-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5bd9b965/" title="Git笔记"><img data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git笔记"/></a><div class="content"><a class="title" href="/posts/5bd9b965/" title="Git笔记">Git笔记</a><time datetime="2020-12-11T10:41:42.000Z" title="发表于 2020-12-11 18:41:42">2020-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f14ce4db/" title="ElasticSearch笔记"><img data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211173025.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ElasticSearch笔记"/></a><div class="content"><a class="title" href="/posts/f14ce4db/" title="ElasticSearch笔记">ElasticSearch笔记</a><time datetime="2020-12-11T09:43:59.000Z" title="发表于 2020-12-11 17:43:59">2020-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b5c2b25e/" title="提取Wallpaper Engine中的壁纸"><img data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201211154953.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="提取Wallpaper Engine中的壁纸"/></a><div class="content"><a class="title" href="/posts/b5c2b25e/" title="提取Wallpaper Engine中的壁纸">提取Wallpaper Engine中的壁纸</a><time datetime="2020-12-11T07:42:43.000Z" title="发表于 2020-12-11 15:42:43">2020-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ae713651/" title="Typora + PicGo + Gitee 实现免费的图床"><img data-lazy-src="https://gitee.com/quehua/blogimg/raw/master/img/20201207170119.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Typora + PicGo + Gitee 实现免费的图床"/></a><div class="content"><a class="title" href="/posts/ae713651/" title="Typora + PicGo + Gitee 实现免费的图床">Typora + PicGo + Gitee 实现免费的图床</a><time datetime="2020-11-30T08:32:20.000Z" title="发表于 2020-11-30 16:32:20">2020-11-30</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://gitee.com/quehua/blogimg/raw/master/img/20201211173025.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 By 云雀</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://xurongchang.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'gJSo6h4nPOdXOlxu0YT5CoAn-gzGzoHsz',
      appKey: 'EmWNKCg373rEpSYKUktd7skC',
      placeholder: '说点什么吧...',
      avatar: 'monsterid',
      meta: '昵称,邮箱,网址'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('昵称,邮箱'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script></div></body></html>